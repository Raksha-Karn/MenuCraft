{% extends "base.html" %} {% block title %}Register | Restaurant Menu
Generator{% endblock %} {% block content %}
<div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-md">
    <h2 class="font-playfair text-3xl mb-6 text-center">Create an Account</h2>

    <div
        id="register-error"
        class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
    >
        <p class="error-message"></p>
    </div>

    <form id="register-form" class="space-y-4">
        <div>
            <label
                for="username"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Username</label
            >
            <input
                type="text"
                id="username"
                name="username"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <label
                for="email"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Email</label
            >
            <input
                type="email"
                id="email"
                name="email"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <label
                for="first_name"
                class="block text-sm font-medium text-gray-700 mb-1"
                >First Name</label
            >
            <input
                type="text"
                id="first_name"
                name="first_name"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <label
                for="last_name"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Last Name</label
            >
            <input
                type="text"
                id="last_name"
                name="last_name"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <label
                for="password"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Password</label
            >
            <input
                type="password"
                id="password"
                name="password"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <label
                for="password2"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Confirm Password</label
            >
            <input
                type="password"
                id="password2"
                name="password2"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <button
                type="submit"
                class="w-full btn-primary py-2 rounded-md font-medium"
            >
                Register
            </button>
        </div>
    </form>

    <div class="mt-4 text-center">
        <p>
            Already have an account?
            <a href="/login" class="text-accent hover:underline">Login here</a>
        </p>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const registerForm = document.getElementById("register-form");
        const errorDiv = document.getElementById("register-error");
        const errorMessage = errorDiv.querySelector(".error-message");
        registerForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            const username = document.getElementById("username").value;
            const email = document.getElementById("email").value;
            const firstName = document.getElementById("first_name").value;
            const lastName = document.getElementById("last_name").value;
            const password = document.getElementById("password").value;
            const password2 = document.getElementById("password2").value;

            if (password !== password2) {
                errorMessage.textContent = "Password fields didn't match.";
                errorDiv.classList.remove("hidden");
                return;
            }

            try {
                const response = await fetch("/api/auth/register/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        username,
                        email,
                        first_name: firstName,
                        last_name: lastName,
                        password,
                        password2,
                    }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    let errorMsg = "Registration failed.";

                    if (typeof errorData === "object") {
                        const errors = [];
                        for (const key in errorData) {
                            if (Array.isArray(errorData[key])) {
                                errors.push(
                                    `${key}: ${errorData[key].join(", ")}`,
                                );
                            }
                        }
                        if (errors.length > 0) {
                            errorMsg = errors.join("\n");
                        }
                    }

                    throw new Error(errorMsg);
                }

                window.location.href = "/login?registered=true";
            } catch (error) {
                errorMessage.textContent = error.message;
                errorDiv.classList.remove("hidden");
            }
        });
    });
</script>
{% endblock %} {% endblock %}
