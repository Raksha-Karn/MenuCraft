{% extends "base.html" %} {% block title %} Login | Restaurant Menu Generator
{%endblock %} {% block content %}
<div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow-md">
    <h2 class="font-playfair text-3xl mb-6 text-center">Login</h2>

    <div
        id="login-error"
        class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"
    >
        <p class="error-message"></p>
    </div>

    <form id="login-form" class="space-y-4">
        <div>
            <label
                for="username"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Username</label
            >
            <input
                type="text"
                id="username"
                name="username"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <label
                for="password"
                class="block text-sm font-medium text-gray-700 mb-1"
                >Password</label
            >
            <input
                type="password"
                id="password"
                name="password"
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary"
                required
            />
        </div>

        <div>
            <button
                type="submit"
                class="w-full btn-primary py-2 rounded-md font-medium"
            >
                Sign in
            </button>
        </div>
    </form>

    <div class="mt-4 text-center">
        <p>
            Don't have an account?
            <a href="/register" class="text-accent hover:underline"
                >Register here</a
            >
        </p>
    </div>
</div>

{% block extra_js %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const loginForm = document.getElementById("login-form");
        const errorDiv = document.getElementById("login-error");
        const errorMessage = errorDiv.querySelector(".error-message");
        const urlParams = new URLSearchParams(window.location.search);

        loginForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;

            try {
                const response = await fetch("/api/auth/login/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ username, password }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(
                        errorData.detail ||
                            "Login failed. Please check your credentials.",
                    );
                }

                const data = await response.json();

                localStorage.setItem("accessToken", data.access);
                localStorage.setItem("refreshToken", data.refresh);

                const redirectTo = urlParams.get("next") || "/";

                window.location.href = redirectTo;
            } catch (error) {
                errorMessage.textContent = error.message;
                errorDiv.classList.remove("hidden");
                registrationSuccess.classList.add("hidden");
            }
        });
    });
</script>
{% endblock %} {% endblock %}
